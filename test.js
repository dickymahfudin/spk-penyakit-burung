const listGejala = [
  {
    id: 1,
    kode: 'P1',
    nama: 'Tetelo',
    createdAt: '2021-12-09T01:55:50.620Z',
    updatedAt: '2021-12-09T01:55:50.620Z',
    ListGejalas: [
      {
        id: 1,
        penyakitId: 1,
        gejalaId: 1,
        bobot: 1.5,
        keterangan: 'Ringan ',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 1,
          kode: 'G1',
          nama: 'Bersin',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 2,
        penyakitId: 1,
        gejalaId: 2,
        bobot: 1.5,
        keterangan: 'Ringan ',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 2,
          kode: 'G2',
          nama: 'Mendengkur',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 3,
        penyakitId: 1,
        gejalaId: 3,
        bobot: 2.5,
        keterangan: 'Sedang ',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 3,
          kode: 'G3',
          nama: 'Lesu',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 4,
        penyakitId: 1,
        gejalaId: 4,
        bobot: 1.5,
        keterangan: 'Ringan',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 4,
          kode: 'G4',
          nama: 'Mata Ngantuk',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 5,
        penyakitId: 1,
        gejalaId: 5,
        bobot: 1.5,
        keterangan: 'Ringan',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 5,
          kode: 'G5',
          nama: 'Batuk-Batuk',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 6,
        penyakitId: 1,
        gejalaId: 6,
        bobot: 2.5,
        keterangan: 'Sedang',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 6,
          kode: 'G6',
          nama: 'Ganguan Pernafasan',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 7,
        penyakitId: 1,
        gejalaId: 7,
        bobot: 3.5,
        keterangan: 'Parah',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 7,
          kode: 'G7',
          nama: 'Kotoran Encer Kehijauan',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 8,
        penyakitId: 1,
        gejalaId: 8,
        bobot: 3.5,
        keterangan: 'Parah',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 8,
          kode: 'G8',
          nama: 'Lumpuh',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
    ],
  },
  {
    id: 2,
    kode: 'P2',
    nama: 'Pilek dan snot',
    createdAt: '2021-12-09T01:55:50.620Z',
    updatedAt: '2021-12-09T01:55:50.620Z',
    ListGejalas: [
      {
        id: 9,
        penyakitId: 2,
        gejalaId: 3,
        bobot: 2.5,
        keterangan: 'Sedang',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 3,
          kode: 'G3',
          nama: 'Lesu',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 10,
        penyakitId: 2,
        gejalaId: 1,
        bobot: 2.5,
        keterangan: 'Sedang',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 1,
          kode: 'G1',
          nama: 'Bersin',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 11,
        penyakitId: 2,
        gejalaId: 9,
        bobot: 1.5,
        keterangan: 'Ringan',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 9,
          kode: 'G9',
          nama: 'Kurus',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 12,
        penyakitId: 2,
        gejalaId: 10,
        bobot: 2.5,
        keterangan: 'Sedang',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 10,
          kode: 'G10',
          nama: 'Air Mata Sering Keluar',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 13,
        penyakitId: 2,
        gejalaId: 11,
        bobot: 3.5,
        keterangan: 'Parah',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 11,
          kode: 'G11',
          nama: 'Mata Merah',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 14,
        penyakitId: 2,
        gejalaId: 12,
        bobot: 2.5,
        keterangan: 'Sedang',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 12,
          kode: 'G12',
          nama: 'Mata Bengkak',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
    ],
  },
  {
    id: 3,
    kode: 'P3',
    nama: 'Berak Darah',
    createdAt: '2021-12-09T01:55:50.620Z',
    updatedAt: '2021-12-09T01:55:50.620Z',
    ListGejalas: [
      {
        id: 15,
        penyakitId: 3,
        gejalaId: 13,
        bobot: 3.5,
        keterangan: 'Parah',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 13,
          kode: 'G13',
          nama: 'Nafsu Makan Berkurang',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 16,
        penyakitId: 3,
        gejalaId: 14,
        bobot: 1.5,
        keterangan: 'Ringan',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 14,
          kode: 'G14',
          nama: 'Mencret',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 17,
        penyakitId: 3,
        gejalaId: 15,
        bobot: 2.5,
        keterangan: 'Sedang',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 15,
          kode: 'G15',
          nama: 'Menggigil',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 18,
        penyakitId: 3,
        gejalaId: 16,
        bobot: 1.5,
        keterangan: 'Ringan',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 16,
          kode: 'G16',
          nama: 'Berat Badan Mengalami Penurunan',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
    ],
  },
  {
    id: 4,
    kode: 'P4',
    nama: 'Cacar Unggas',
    createdAt: '2021-12-09T01:55:50.620Z',
    updatedAt: '2021-12-09T01:55:50.620Z',
    ListGejalas: [
      {
        id: 19,
        penyakitId: 4,
        gejalaId: 17,
        bobot: 2.5,
        keterangan: 'Sedang',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 17,
          kode: 'G17',
          nama: 'Kopeng-Kopeng Pada Bagian Tidak Berbulu',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 20,
        penyakitId: 4,
        gejalaId: 18,
        bobot: 3.5,
        keterangan: 'Parah',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 18,
          kode: 'G18',
          nama: 'Bila Dilepas Keluar Darah',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 21,
        penyakitId: 4,
        gejalaId: 13,
        bobot: 3.5,
        keterangan: 'Parah',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 13,
          kode: 'G13',
          nama: 'Nafsu Makan Berkurang',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 22,
        penyakitId: 4,
        gejalaId: 19,
        bobot: 1.5,
        keterangan: 'Ringan',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 19,
          kode: 'G19',
          nama: 'Bulu Napak Kusam',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 23,
        penyakitId: 4,
        gejalaId: 20,
        bobot: 3.5,
        keterangan: 'Parah',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 20,
          kode: 'G20',
          nama: 'Sayap Terkulai',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
    ],
  },
  {
    id: 5,
    kode: 'P5',
    nama: 'Quail Bronchitis',
    createdAt: '2021-12-09T01:55:50.620Z',
    updatedAt: '2021-12-09T01:55:50.620Z',
    ListGejalas: [
      {
        id: 24,
        penyakitId: 5,
        gejalaId: 3,
        bobot: 2.5,
        keterangan: 'Sedang',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 3,
          kode: 'G3',
          nama: 'Lesu',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 25,
        penyakitId: 5,
        gejalaId: 19,
        bobot: 1.5,
        keterangan: 'Ringan',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 19,
          kode: 'G19',
          nama: 'Bulu Napak Kusam',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 26,
        penyakitId: 5,
        gejalaId: 21,
        bobot: 1.5,
        keterangan: 'Ringan',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 21,
          kode: 'G21',
          nama: 'Mata Dan Hidung Keluar Lendir',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 27,
        penyakitId: 5,
        gejalaId: 22,
        bobot: 2.5,
        keterangan: 'Sedang',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 22,
          kode: 'G22',
          nama: 'Tubuh gemetar',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 28,
        penyakitId: 5,
        gejalaId: 5,
        bobot: 2.5,
        keterangan: 'Sedang',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 5,
          kode: 'G5',
          nama: 'Batuk-Batuk',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 29,
        penyakitId: 5,
        gejalaId: 1,
        bobot: 1.5,
        keterangan: 'Ringan',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 1,
          kode: 'G1',
          nama: 'Bersin',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
      {
        id: 30,
        penyakitId: 5,
        gejalaId: 23,
        bobot: 3.5,
        keterangan: 'Parah',
        createdAt: '2021-12-09T01:55:50.691Z',
        updatedAt: '2021-12-09T01:55:50.691Z',
        gejala: {
          id: 23,
          kode: 'G23',
          nama: 'Kepala dan leher Terpuntir',
          createdAt: '2021-12-09T01:55:50.657Z',
          updatedAt: '2021-12-09T01:55:50.657Z',
        },
      },
    ],
  },
];

const inputUser = [
  { gejalaId: 1, bobot: 0.8 },
  { gejalaId: 2, bobot: 0.8 },
  { gejalaId: 3, bobot: 1 },
  { gejalaId: 4, bobot: 0.8 },
];

const himpunan = (x, index, input, bobot) => {
  const ringan = 1.16,
    sedang = 1.75,
    parah = 2.33;
  let result = 0;
  if (x <= ringan) {
    result = +((x - 1.16) / (0 - 1.16)).toFixed(3);
    return {
      id: input.gejalaId,
      nama: input.nama,
      bobot,
      result,
      z: +(result * bobot).toFixed(3),
      keterangan: 'ringan',
      latex: `\\[a${+index + 1} = {${x} - 1.16 \\over 0 - 1.16} = ${result}\\]`,
    };
  } else if (x >= ringan && x <= sedang) {
    result = +((x - 1.16) / (1.75 - 1.16)).toFixed(3);
    return {
      id: input.gejalaId,
      nama: input.nama,
      bobot,
      result,
      z: +(result * bobot).toFixed(3),
      keterangan: 'sedang1',
      latex: `\\[a${+index + 1} = {${x} - 1.16 \\over 1.75 - 1.16} = ${result}\\]`,
    };
  } else if (x > sedang && x <= parah) {
    result = +((x - 2.33) / (1.75 - 2.33)).toFixed(3);
    return {
      id: input.gejalaId,
      nama: input.nama,
      bobot,
      result,
      z: +(result * bobot).toFixed(3),
      keterangan: 'sedang2',
      latex: `\\[a${+index + 1} = {${x} - 2.33 \\over 1.75 - 2.33} = ${result}\\]`,
    };
  } else {
    result = +((x - 2.33) / (3.5 - 2.33)).toFixed(3);
    return {
      id: input.gejalaId,
      nama: input.nama,
      bobot,
      result,
      z: +(result * bobot).toFixed(3),
      keterangan: 'parah',
      latex: `\\[a${+index + 1} = {${x} - 2.33 \\over 1.75 - 2.33} = ${result}\\]`,
    };
  }
};

const analisa = ({ listGejala, inputs }) => {
  const inputLength = inputs.length;
  let result;
  const tempHimpunan = [];
  const defuzzyfikasi = { a: 0, z: 0, latex: '', result: 0 };
  for (const key in listGejala) {
    if (Object.hasOwnProperty.call(listGejala, key)) {
      const gejala = listGejala[key];
      let count = 0;
      for (const e in inputs) {
        if (Object.hasOwnProperty.call(inputs, e)) {
          const input = inputs[e];
          const findListPenyakit = gejala.ListGejalas.find(e => e.gejalaId === input.gejalaId);
          if (findListPenyakit) {
            const calHimpunan = (findListPenyakit.bobot * input.bobot).toFixed(1);
            tempHimpunan.push(himpunan(calHimpunan, e, input, findListPenyakit.bobot));
            count += 1;
          }
        }
      }
      if (count === inputLength) {
        result = gejala;
        const lengthGejala = result.ListGejalas.length;
        const sumA = +tempHimpunan
          .map(item => +item.result)
          .reduce((prev, curr) => prev + curr, 0)
          .toFixed(3);
        const sumZ = +tempHimpunan
          .map(item => +item.z)
          .reduce((prev, curr) => prev + curr, 0)
          .toFixed(3);

        const sumAZ = +(sumA / sumZ).toFixed(3);

        defuzzyfikasi.a = sumA;
        defuzzyfikasi.z = sumZ;
        defuzzyfikasi.result = sumAZ;
        defuzzyfikasi.latex = `\\[a = {${sumA} \over ${sumZ}} = ${sumAZ}\\]`;

        const pAwal = +((sumAZ / lengthGejala) * 100).toFixed(2);
        const pAkhir = +((inputLength / lengthGejala) * pAwal).toFixed(2);

        return { result, himpunan: tempHimpunan, defuzzyfikasi, pAwal, pAkhir };
      }
    }
  }
};

console.log(analisa({ listGejala, inputs: inputUser }));
